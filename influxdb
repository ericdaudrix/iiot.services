#!/bin/bash

# Script d'installation d'InfluxDB 1.8.10 pour Raspberry Pi 4
# Fonctionne pour Raspbian OS 32 bits (armhf) ou 64 bits (aarch64)

set -e

echo "ğŸ“¦ Mise Ã  jour du systÃ¨me..."
sudo apt update && sudo apt upgrade -y

echo "ğŸ“ CrÃ©ation d'un dossier temporaire..."
cd ~
mkdir -p influxdb_install
cd influxdb_install

ARCH=$(uname -m)

if [[ "$ARCH" == "aarch64" ]]; then
    ARCH_TYPE="arm64"
elif [[ "$ARCH" == "armv7l" ]]; then
    ARCH_TYPE="armhf"
else
    echo "âŒ Architecture non supportÃ©e : $ARCH"
    exit 1
fi

echo "ğŸ”½ TÃ©lÃ©chargement d'InfluxDB v1.8.10 ($ARCH_TYPE)..."

if [[ "$ARCH_TYPE" == "armhf" ]]; then
    wget https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_armhf.deb
    PACKAGE="influxdb_1.8.10_armhf.deb"
else
    wget https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_arm64.deb
    PACKAGE="influxdb_1.8.10_arm64.deb"
fi

echo "ğŸ“¦ Installation du paquet..."
sudo dpkg -i $PACKAGE

echo "ğŸ› ï¸ VÃ©rification des dÃ©pendances..."
sudo apt --fix-broken install -y

echo "ğŸš€ Activation et dÃ©marrage du service InfluxDB..."
sudo systemctl enable influxdb
sudo systemctl start influxdb

echo "âœ… Installation terminÃ©e !"

echo -e "\nğŸ“Š Test : InfluxDB devrait maintenant Ãªtre accessible sur le port 8086."
echo "Tapez la commande suivante pour vÃ©rifier :"
echo "    influx"
