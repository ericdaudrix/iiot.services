#!/bin/bash

# Vérification des privilèges root
if [ "$EUID" -ne 0 ]; then
  echo "Veuillez exécuter ce script en tant que root : sudo ./install_rc_local_service.sh"
  exit 1
fi

# Création du fichier /etc/rc.local si manquant
if [ ! -f /etc/rc.local ]; then
  echo "Création du fichier /etc/rc.local..."
  cat <<EOF > /etc/rc.local
#!/bin/bash
# Fichier rc.local pour exécuter des commandes au démarrage

echo "Le service rc.local a démarré correctement." > /tmp/rc-local.log
exit 0
EOF
fi

# Rendre le fichier exécutable
echo "Rendre /etc/rc.local exécutable..."
chmod +x /etc/rc.local

# Création du service systemd si manquant
if [ ! -f /etc/systemd/system/rc-local.service ]; then
  echo "Création du fichier de service rc-local.service..."
  cat <<EOF > /etc/systemd/system/rc-local.service
[Unit]
Description=/etc/rc.local Compatibility
ConditionPathExists=/etc/rc.local
After=network.target

[Service]
Type=forking
ExecStart=/etc/rc.local start
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
SysVStartPriority=99

[Install]
WantedBy=multi-user.target
EOF
fi

# Rechargement de systemd
echo "Rechargement de systemd..."
systemctl daemon-reload

# Activation et démarrage du service rc-local
echo "Activation et démarrage du service rc-local..."
systemctl enable rc-local
systemctl start rc-local

# Vérification du statut
echo "Vérification du statut du service rc-local..."
systemctl status rc-local --no-pager

echo "Installation du service rc.local terminée."
